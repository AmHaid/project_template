
## Setup a private website for a project

These instructions are adapted from Ben Balter's [jekyll-auth setup instructions](https://github.com/benbalter/jekyll-auth) to meet my specific use when creating restricted access to project website/dashboards. 

Assume that you already have an organization account and a project repository in containing:
- master branch with some code
- .gitignore file

### Create a GitHub Application

1. Navigate to [the GitHub app registration page](https://github.com/settings/applications/new) of your organization.
2. Give your app a name
3. Tell GitHub the URL you want the app to eventually live at. If using a free Heroku account, this will be something like <https://my-site.herokuapp.com>
4. Specify the callback URL; should be like this: <https://my-site.herokuapp.com/auth/github/callback>; note that this is **https**, not http.
5. Hit Save, but leave the page open, you'll need some of the information in a moment

Remember the 'my-site' part for later on when using `heroku create`. Also, my-site is often called 'app-name' in Heroku documentation.

### Create a hk-pages branch

Following [Github instructions](https://help.github.com/articles/creating-project-pages-using-the-command-line), clone a fresh copy of your repository in order to protect the non-tracked file in the original repository. In addition, we need to save the `.gitignore` file to restaure it

    cd ~/Desktop
    git clone https://github.com/username/repository.git
    cd repository
    git checkout --orphan hk-pages
    cp .gitignore ../.gitignore
    git rm -rf .
    cp ../.gitignore .gitignore
    echo "More soon.." > index.html
    git add .
    git commit -a -m "First pages commit"
    git push origin hk-pages
    cd ..
    rm -rf repository


### Add Jekyll Auth to your site

Go back to the original repository.

1. Within your `hk-pages` branch, add `gem 'jekyll-auth'` to your `Gemfile` or if you don't already have a `Gemfile`, create a file called `Gemfile` in the root of your site's repository with the following content:

   ```ruby
   source "https://rubygems.org"

   gem 'jekyll-auth'
   ```
This can be done with the following command:

    printf "source \"https://rubygems.org\"\n\ngem 'jekyll-auth'\n" > Gemfile

2. `cd` into your project's directory and run `bundle install`. If you get an error using `bundle install`, see Troubleshooting below.

3. Run `bundle exec jekyll-auth new` which will copy the necessary files to set up the server

4. Add and commit the files generated by `jekyll-auth new` to Git before continuing
    git add .
    git commit -a -m "Setup jekyll-auth"


### Create a Github team and fill your `.env` file

This team only will have access to the website. 

1. Create a new team for your organisation
2. Create a new token from your personnal account (only need _read:org_ rights) and save it in the `.env` file
    GITHUB_TOKEN=XXX
3. Get your team id with the following command (@orgName/teamName)
    jekyll-auth team_id --org orgName --team teamName
4. Save your team id in you `.env` file
    GITHUB_TEAM_ID=XXX
5. Go back to the GitHub app registration page and complete `GITHUB_CLIENT_ID` and `GITHUB_CLIENT_SECRET` in your `.env` file.

### Setting up hosting with Heroku

1. Make sure you have [the Heroku toolbelt](https://toolbelt.heroku.com/) installed
2. Run `heroku create my-site` from your site's directory; make sure my-site matches what you specified in the GitHub application registration above.
3. `GITHUB_CLIENT_ID=XXX GITHUB_CLIENT_SECRET=XXX GITHUB_ORG_NAME=XXX` (or `GITHUB_TEAM_ID`)
4. `git push heroku hk-pages:master`
5. `heroku open` to open the site in your browser


### Refences
 
- https://github.com/benbalter/jekyll-auth
- https://github.com/benbalter/jekyll-auth/issues/29
- http://fabian-kostadinov.github.io/2014/11/13/installation-of-jekyll-auth/
